#include <stdio.h>
#include <stdlib.h>
#include <string.h>
struct abone
{
    char adi_soyadi[26];
    char birim_adi[31];
    int abone_tipi;
    int hazir_kontor;
};
struct gorusme
{
    int arayan;
    char aranan[11];
    int gun_no;//tarih
    int baslangic_saati;
    int baslangic_dakikasi;
    int sure;//dakika
};
int menu();
void tumunu_listele();//silinecek
void abone_listele();
void abone_gorusme_listele();
void birime_gore_abone_listele();
void abone_sayi_ve_yuzdesi();
void gune_gore_gorusmeler();
void gorusme_sayi_ve_sureleri();
void mecburi_kontor_yukleme();
void sirala(int *deger,int *deger2);
void degistir(int *a,int *b);
int main()
{
    int secim;
    for(;;)
    {
        secim=menu();
        fflush(stdin);
        switch(secim)
        {
        case 1:
            abone_listele();
            break;
        case 2:
            abone_gorusme_listele();
            break;
        case 3:
            birime_gore_abone_listele();
            break;
        case 4:
            abone_sayi_ve_yuzdesi();
            break;
        case 5:
            gune_gore_gorusmeler();
            break;
        case 6:
            gorusme_sayi_ve_sureleri();
            break;
        case 7:
            mecburi_kontor_yukleme();
            break;
        default:
            exit(EXIT_SUCCESS);
        }
    }
    return 0;
}
void abone_listele()
{
    FILE *fptr;
    struct abone kisi=
    {
        "","",0,0
    };
    int dahili_tel_no;
    char *dosya_adi= "abone.dat",*amac="r",*abone_tipi[5]= {"Bos","Akademik","Idari","Yonetici","Diger"};
    if ((fptr=fopen(dosya_adi,amac))==NULL)
    {
        printf("abone.dat acilamadi!\n");//Dosya acilamadiginda ekrana mesaj gönderiliyor
    }
    //Dosya acilirsa diger islemler yapilmaktadir
    else
    {
        printf("Abonenin dahili telefon numarasini giriniz\n?");
        scanf("%d",&dahili_tel_no);
        fseek(fptr,(dahili_tel_no-100)*sizeof(struct abone),SEEK_SET);
        fread(&kisi,sizeof(struct abone),1,fptr);
        if(kisi.abone_tipi!=0)
        {
            printf("Tel No Ad Soyad                  Birimi                         Tip      Kontor\n");
            printf("------ ------------------------- ------------------------------ -------- ------\n");
            printf("%-7d%-26s%-31s%-9s%d\n",dahili_tel_no,kisi.adi_soyadi,kisi.birim_adi,abone_tipi[kisi.abone_tipi],kisi.hazir_kontor);
        }
        else
        {
            printf("#%d dahili numarali abone bulunamamistir!\n",dahili_tel_no);
        }
    }
    fclose(fptr);
}
void abone_gorusme_listele()
{
    printf("yapilmadi\n");
}
void birime_gore_abone_listele()
{
    char birim_adi[31];
    FILE *fptr;
    struct abone kisi=
    {
        "","",0,0
    };
    int x,y,z,t;
    char *dosya_adi= "abone.dat",*amac="r",*abone_tipi[5]= {"Bos","Akademik","Idari","Yonetici","Diger"};
    if ((fptr=fopen(dosya_adi,amac))==NULL)
    {
        printf("abone.dat acilamadi!\n");//Dosya acilamadiginda ekrana mesaj gonderiliyor
    }
    //Dosya acilirsa diger islemler yapilmaktadir
    else
    {
        printf("Birim adini giriniz:\n?");
        gets(birim_adi);
        y=strlen(birim_adi);
        printf("Tel No Ad Soyad                  Birimi                         Tip      Kontor\n");
        printf("------ ------------------------- ------------------------------ -------- ------\n");
        x=-1;
        while(!feof(fptr))
        {
            x++;
            fread(&kisi,sizeof(struct abone),1,fptr);
            z=strncmp(birim_adi,kisi.birim_adi,y);
            t=strlen(kisi.birim_adi);
            if(kisi.abone_tipi!=0)
            {
                if(t==y&&z==0)//Eslesme olursa
                {
                    printf("%-7d%-26s%-31s%-9s%d\n",x+100,kisi.adi_soyadi,kisi.birim_adi,abone_tipi[kisi.abone_tipi],kisi.hazir_kontor);
                }
            }
        }
    }
}
void abone_sayi_ve_yuzdesi()
{
    FILE *fptr;
    struct abone kisi=
    {
        "","",0,0
    };
    int x=0,sayac[5]= {0},kayit_sayisi=0,tip[5]={0,1,2,3,4};
    char *dosya_adi= "abone.dat",*amac="r",*abone_tipi[5]= {"Bos","Akademik","Idari","Yonetici","Diger"};
    if ((fptr=fopen(dosya_adi,amac))==NULL)
    {
        printf("abone.dat acilamadi!\n");//Dosya acilamadiginda ekrana mesaj gönderiliyor
    }
    //Dosya acilirsa diger islemler yapilmaktadir
    else
    {
        while(!feof(fptr))
        {
            fread(&kisi,sizeof(struct abone),1,fptr);
            ++sayac[kisi.abone_tipi];
        }
        sirala(sayac,tip);
        for(x=0;x<5;x++)
        {
            kayit_sayisi+=sayac[x];
        }
        printf("kayit_sayisi:%d",kayit_sayisi);
        printf("Abone Tipi Abone Sayisi Yuzde\n");
        printf("---------- ------------ -----\n");
        for(x=1;x<5;x++)
        {
            printf("%-11s%-13d%03.02f\n",abone_tipi[tip[x]],sayac[x],(float)sayac[x]*100/901);
        }
        printf("-----------------------------\n");
        printf("%-11s%-13d%03.02f\n",abone_tipi[0],sayac[0],(float)sayac[0]*100/901);
    }
}
void gune_gore_gorusmeler()
{
    printf("yapilmadi\n");
}
void gorusme_sayi_ve_sureleri()
{
    printf("yapilmadi\n");
}
void mecburi_kontor_yukleme()
{
    FILE *fptr;
    struct abone kisi=
    {
        "","",0,0
    };
    int x;
    char *dosya_adi= "abone.dat",*amac="r",*abone_tipi[5]= {"Bos","Akademik","Idari","Yonetici","Diger"};
    if ((fptr=fopen(dosya_adi,amac))==NULL)
    {
        printf("abone.dat acilamadi!\n");//Dosya acilamadiginda ekrana mesaj gönderiliyor
    }
    //Dosya acilirsa diger islemler yapilmaktadir
    else
    {
        printf("Tel No Ad Soyad                  Birimi                         Tip      Kontor\n");
        printf("------ ------------------------- ------------------------------ -------- ------\n");
        x=-1;
        while(!feof(fptr))
        {
            x++;
            fread(&kisi,sizeof(struct abone),1,fptr);
            if(kisi.abone_tipi!=0&&kisi.hazir_kontor<-100)
            {
                    printf("%-7d%-26s%-31s%-9s%d\n",x+100,kisi.adi_soyadi,kisi.birim_adi,abone_tipi[kisi.abone_tipi],kisi.hazir_kontor);
            }
        }
    }
}
void tumunu_listele()
{
    FILE *fptr;
    struct abone kisi=
    {
        "","",0,0
    };
    int x;
    char *dosya_adi= "abone.dat",*amac="r";
    if ((fptr=fopen(dosya_adi,amac))==NULL)
    {
        printf("abone.dat acilamadi!\n");//Dosya acilamadiginda ekrana mesaj gönderiliyor
    }
    //Dosya acilirsa diger islemler yapilmaktadir
    else
    {
        x=-1;
        while(!feof(fptr))
        {
            x++;
            fread(&kisi,sizeof(struct abone),1,fptr);
            if(kisi.abone_tipi!=0)
            {
                printf("x:%d#%s#%s#%d#%d#\n",x+100,kisi.adi_soyadi,kisi.birim_adi,kisi.abone_tipi,kisi.hazir_kontor);
            }
        }
    }
}
int menu(void)
{
    int secim;
    printf("\n\n1) Bir abonenin bilgilerinin listelenmesi\n");
    printf("2) Bir abonenin bilgilerinin ve o ay yapmis\n");
    printf("   oldugu dis hat gorusmelerinin listelenmesi\n");
    printf("3) Bir birimdeki abonelerin bilgilerinin listelenmesi\n");
    printf("4) Abone tipine gore abone sayilarinin ve yuzdelerinin listelenmesi\n");
    printf("5) Bir gun yapilan gorusmelerin listelenmesi\n");
    printf("6) Gune gore gorusme sayilarinin ve surelerinin listelenmesi\n");
    printf("7) Dis hat gorusmesi yapabilmek icin kontor\n");
    printf("   yuklemesi gereken abonelerin listelenmesi\n");
    printf("8) Cikis\n");
    printf("Seciminiz {[1-8]}\n?");
    scanf("%d", &secim);
    fflush(stdin);
    while(secim<1 || secim>8)
    {
        printf("\nHatali girdiniz!!!\nSeciminizi tekrar giriniz:\n");
        scanf("%d", &secim);
    }
    return secim;
}
void sirala(int *deger,int *deger2)
{
    int tur,karsilastirma;
    for (tur=0; tur<3; ++tur)//eleman sayýsý-1
    {
        for (karsilastirma=3; karsilastirma>=1; --karsilastirma)
            //karþýlaþtýrma yapýlýrken aþaðýdan yukarý dogru yapýlýyor
            //n:eleman sayýsý dersek n-1 karþýlaþtýrma vardýr.
        {
            if (deger[karsilastirma]<deger[karsilastirma+1])//Oy miktarýna göre partiler sýralanýyor
            {
                degistir(&deger[karsilastirma],&deger[karsilastirma+1]);
                degistir(&deger2[karsilastirma],&deger2[karsilastirma+1]);
            }
        }
        //n-1 tur vardýr.
    }
}
void degistir(int *a,int *b)//iki sayýyý birbirine atamak için kullanýldý
{
    int tut;
    //verilen iki sayýnýn yerleri deðiþiyor
    tut=*a;
    *a=*b;
    *b=tut;
}
